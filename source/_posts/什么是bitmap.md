---
title: ä»€ä¹ˆæ˜¯bitmap
tags:
  - æ•°æ®ç»“æ„
  - é¢è¯•
  - å¸ƒéš†è¿‡æ»¤å™¨
categories:
  - é¢è¯•
cover: https://fuos.github.io/picx-images-hosting/20240820/913AC0c950493225AEB55a495Db79669.1e8j5x8ohr.webp
abbrlink: 51635cb9
date: 2024-08-20 11:28:32
---

åœ¨äº†è§£bitmapä¹‹å‰ï¼Œå…ˆçœ‹ä¸‹Javaä¸­çš„8ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ï¼š
![javabasicdatatype](https://fuos.github.io/picx-images-hosting/20240824/javabasicdatatype.7p3j9tjnal.webp)
å¯ä»¥çœ‹åˆ°ï¼Œä¸åŒæ•°æ®ç±»å‹ï¼Œå ç”¨çš„å­˜å‚¨ç©ºé—´ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ã€‚è¿™é‡Œä¸»è¦æœ‰ä¸¤ä¸ªå•ä½ï¼šbyteå’Œbitã€‚
## byte
`byte`å°±æ˜¯å¹³å¸¸è¯´çš„*å­—èŠ‚*ï¼Œæ˜¯è®¡ç®—æœºä¸­*åŸºæœ¬å­˜å‚¨å•ä½*ã€‚å¯ä»¥çœ‹åˆ°é™¤äº†booleanï¼Œå…¶ä»–åŸºæœ¬æ•°æ®ç±»å‹éƒ½æ˜¯ä»¥byteä½œä¸ºåŸºæœ¬å­˜å‚¨å•ä½çš„ã€‚è®¡ç®—æœºåœ¨å¤„ç†æ•°æ®æ—¶ï¼Œä¹Ÿæ˜¯ä»¥å­—èŠ‚æ¥å¤„ç†å’Œå­˜å‚¨çš„ï¼Œä¸€ä¸ªå­—èŠ‚é€šå¸¸æœ‰8ä½æ„æˆã€‚ä»¥æ— ç¬¦å·æ•°ä¸ºä¾‹ï¼Œä¸€ä¸ªå­—èŠ‚å¯ä»¥è¡¨ç¤ºä»`00000000`åˆ°`11111111`çš„äºŒè¿›åˆ¶æ•°ï¼Œå³ 0 åˆ° 255 ä¹‹é—´çš„æ•´æ•°ã€‚

## bit
`bit`å°±æ˜¯å¹³æ—¶è¯´çš„*ä½*ï¼Œä¹Ÿå«*æ¯”ç‰¹*ï¼Œæ˜¯è®¡ç®—æœºä¸­*æœ€å°æ•°æ®å•ä½*ï¼Œåªæœ‰ä¸¤ä¸ªå€¼ï¼š`0`å’Œ`1`ï¼Œå¯ä»¥è¡¨ç¤º`true`å’Œ`false`ï¼Œä¸Šé¢çš„booleanå ä½å°±æ˜¯1bitã€‚æˆ‘ä»¬éƒ½çŸ¥é“è®¡ç®—æœºçš„CPUæœ‰32ä½å’Œ64ä½ï¼Œè¿™é‡Œçš„ä½å°±æ˜¯bitï¼Œä½ ä¹Ÿå¯ä»¥è¯´64ä½CPUæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸèƒ½å¤„ç†8å­—èŠ‚æ•°æ®ã€‚1byte = 8 bitã€‚

##  å­—èŠ‚å’Œè¡¨ç¤ºèŒƒå›´
ä»ä¸Šé¢çš„å›¾å¯ä»¥çœ‹å‡ºï¼Œintå’Œfloatéƒ½æ˜¯4ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯éƒ½çŸ¥é“intå’Œfloatèƒ½è¡¨ç¤ºçš„æ•°å€¼èŒƒå›´æ˜¯ä¸åŒçš„ã€‚è¿™æ˜¯å› ä¸ºå­—èŠ‚åªæ˜¯è§„å®šäº†æ•°æ®ç±»å‹çš„é•¿åº¦ï¼Œä»–ä»¬ä¿©éƒ½æ˜¯32ä½çš„ï¼Œä½†æ˜¯å¯¹äºè¿™32ä½çš„å®šä¹‰ç¡®æ˜¯ä¸åŒçš„ï¼š
###  int
`int` ä½¿ç”¨32ä½ç›´æ¥è¡¨ç¤ºä¸€ä¸ªæ•´æ•°å€¼ã€‚
 -   æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ`0` è¡¨ç¤ºæ­£æ•°ï¼Œ`1` è¡¨ç¤ºè´Ÿæ•°ã€‚
 -   å‰©ä½™çš„31ä½ç”¨äºå­˜å‚¨æ•°å€¼çš„äºŒè¿›åˆ¶è¡¥ç è¡¨ç¤ºã€‚
###  float
`float` ä½¿ç”¨IEEE 754æ ‡å‡†çš„å•ç²¾åº¦æµ®ç‚¹æ ¼å¼ï¼Œç”±3éƒ¨åˆ†ç»„æˆï¼š
 - ç¬¦å·ä½ï¼ˆSign bitï¼‰ï¼š1ä½ï¼Œè¡¨ç¤ºæ­£æ•°ï¼ˆ0ï¼‰æˆ–è´Ÿæ•°ï¼ˆ1ï¼‰ã€‚
 - æŒ‡æ•°ä½ï¼ˆExponentï¼‰ï¼š8ä½ï¼Œç”¨äºè¡¨ç¤ºæ•°çš„æŒ‡æ•°éƒ¨åˆ†ï¼Œä½¿ç”¨åç§»é‡ï¼ˆé€šå¸¸ä¸º127ï¼‰ç¼–ç ã€‚
 - å°¾æ•°ï¼ˆMantissa/Significandï¼‰ï¼š23ä½ï¼Œè¡¨ç¤ºæœ‰æ•ˆæ•°å­—éƒ¨åˆ†ï¼ˆå®é™…ä¸Šæ˜¯24ä½ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€é«˜ä½æ˜¯1ï¼Œä½†ä¸å­˜å‚¨ï¼‰ã€‚

> è¿™é‡Œä»…ä»…æ˜¯ç”¨intå’Œfloatä¸¾ä¾‹ï¼Œä¸»è¦æ˜¯ä¸ºäº†è¯´æ˜ä¸åŒçš„å­—èŠ‚é•¿åº¦å’Œæ•°æ®ç»“æ„ï¼Œç»„æˆäº†ä¸åŒçš„æ•°æ®ç±»å‹ã€‚

##  bitmap
äº†è§£äº†`bit`ï¼Œç°åœ¨æ¥çœ‹çœ‹`bitmap`ï¼Œä¹Ÿå°±æ˜¯å¹³æ—¶è¯´çš„ä½å›¾ï¼Œå®ƒæ˜¯ç”¨äºå­˜å‚¨å’Œæ“ä½œ**ä½**ä¿¡æ¯çš„æ•°æ®ç»“æ„çš„*æ¦‚å¿µæœ¯è¯­*ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»æˆ–è€…æ•°æ®ç»“æ„ï¼Œä½ å¯ä»¥ä½¿ç”¨byte[]ï¼Œint[]ï¼ŒBitSetç­‰æ–¹å¼å®ç°ä½å›¾ã€‚æˆ‘ä»¬åˆšæ‰è¯´è¿‡bitåªæœ‰ä¸¤ä¸ªå€¼0å’Œ1ï¼ŒBitSetå°±æ˜¯é€šè¿‡äºŒè¿›åˆ¶ä½æ¥è¡¨ç¤ºå’Œå­˜å‚¨æ•°æ®çš„ã€‚
###  ä½¿ç”¨intå’Œbitå­˜å‚¨æ•°å­—13
ä¸‹é¢è¯·çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘å°†ç”¨ä»–æ¥è¯´æ˜bitmapæ˜¯å¦‚ä½•èŠ‚çœå­˜å‚¨ç©ºé—´çš„ï¼šå‡è®¾æœ‰ä¸€ä¸ªæ•°å­—13ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆå­˜å‘¢ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°å¯ä»¥ç”¨intï¼Œç”¨Javaè¡¨ç¤ºå°±æ˜¯ï¼š
```java
public class IntExample {
    public static void main(String[] args) {
        int a = 13; // ç›´æ¥ä½¿ç”¨intå­˜å‚¨æ•°å­—13
        System.out.println("Int value: " + a);
    }
}
```
intæœ‰4å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯32ä½ï¼Œä»–åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š
![inta](https://fuos.github.io/picx-images-hosting/20240825/inta.5fkirdn1as.webp)
`13` çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ `00000000 00000000 00000000 00001101`ï¼Œå› ä¸º 13 = 8 + 4 + 1ï¼Œå¯¹åº”çš„äºŒè¿›åˆ¶ä½æ˜¯ 2Â³ + 2Â² + 2â°ã€‚
ä½ ä¼šå‘ç°ä»–çš„ç©ºé—´æœ‰å¾ˆå¤§çš„æµªè´¹ï¼Œå®é™…ä¸ŠçœŸæ­£ä½¿ç”¨çš„ç©ºé—´åªæœ‰4bitï¼Œå³ä½ä½çš„1101ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨`int`ç±»å‹å­˜å‚¨ï¼Œæˆ‘ä»¬æˆ‘ä»¬ä½¿ç”¨bitå­˜å‚¨ï¼Œé‚£å°±å¯ä»¥èŠ‚çœç©ºé—´ï¼Œç”¨Javaæ¥è¡¨ç¤ºä¸‹ï¼š
```java
import java.util.BitSet;

public class BitSetExample {
    public static void main(String[] args) {
        BitSet bitSet = new BitSet(4); // åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º4çš„BitSet
        // å°†æ•°å­—13è½¬æ¢ä¸ºäºŒè¿›åˆ¶å¹¶å­˜å‚¨åœ¨BitSetä¸­
        // 13çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯1101ï¼Œå¯¹åº”BitSetçš„ç¬¬0, 2, 3ä½ä¸ºtrue
        bitSet.set(0); // è®¾ç½®ç¬¬0ä½ä¸ºtrue, å¯¹åº”2^0
        bitSet.set(2); // è®¾ç½®ç¬¬2ä½ä¸ºtrue, å¯¹åº”2^2
        bitSet.set(3); // è®¾ç½®ç¬¬3ä½ä¸ºtrue, å¯¹åº”2^3
        
        System.out.println("BitSet: " + bitSet); // è¾“å‡ºBitSetå†…å®¹
        System.out.println("BitSet value as integer: " + bitSetToInt(bitSet)); // å°†BitSetè½¬ä¸ºæ•´æ•°è¾“å‡º
    }

    // å°†BitSetè½¬ä¸ºæ•´æ•°çš„è¾…åŠ©æ–¹æ³•
    public static int bitSetToInt(BitSet bitSet) {
        int value = 0;
        for (int i = 0; i < bitSet.length(); i++) {
            if (bitSet.get(i)) {
                value += (1 << i);
            }
        }
        return value;
    }
}
```
ä¸Šé¢ç”¨åˆ°äº†Javaä¸­`BitSet`ç±»ï¼Œä»–æ˜¯ç”¨æ¥æ“ä½œå’Œç®¡ç†ä½çš„é›†åˆã€‚æˆ‘ä»¬é€šè¿‡è‡ªå·±è®°å½•æ•°å­—çš„äºŒè¿›åˆ¶å€¼å­˜å‚¨åˆ°bitä¸­ï¼Œå®ç°äº†æ•°æ®çš„å†™å…¥å’Œè¯»å–ï¼Œè€Œä¸”åªç”¨äº†4ä¸ªbitã€‚
###  ä¸ºä»€ä¹ˆè¦å®šä¹‰åŸºæœ¬æ•°æ®ç±»å‹
é‚£ä¸ºä»€ä¹ˆJavaè¿˜è¦å®šä¹‰intæ˜¯4å­—èŠ‚32ä½å‘¢ï¼Ÿä¸æ˜¯ç›´æ¥ç”¨bitä¹Ÿèƒ½å­˜ï¼Ÿé‚£æ˜¯å› ä¸ºä¸åŒæ•°æ®ç±»å‹è§„å®šäº†æ•°å­—å­˜å‚¨çš„ä¸Šé™å’Œä¸‹é™ï¼Œè™½ç„¶åœ¨ä½ä½ä¼šæµªè´¹ç©ºé—´ï¼Œä½†æ˜¯æ•´ä¸ªintç±»å‹å¤§å°æ˜¯æœ‰è§„å®šçš„ï¼Œæ–¹ä¾¿è®¡ç®—æœºå¯»å€å’Œè®¡ç®—ï¼Œå¦‚æœå•çº¯ä½¿ç”¨bitå»å­˜å–ï¼Œå°±éœ€è¦è‡ªå·±ç¼–å†™è¾…åŠ©æ–¹æ³•å¯¹bitè¿›è¡Œæ“ä½œå’Œç®¡ç†ï¼Œå¢åŠ äº†å¤æ‚åº¦ã€‚å¯ä»¥ç†è§£ä¸ºåŸºæœ¬æ•°æ®ç±»å‹æ˜¯åœ¨bitä¹‹ä¸Šæ ‡å‡†åŒ–çš„å°è£…ğŸ“¦ã€‚
###  bitmapåˆ°åº•æ€ä¹ˆç”¨
bitmapä¸æ˜¯ä¸€ä¸ªç±»ï¼Œä»–æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œä¸€ä¸ªæŠ€æœ¯æœ¯è¯­ã€‚ä¸Šé¢ä¾‹å­ä¸­ç”¨åˆ°çš„*BitSetæ˜¯bitmapçš„å…·ä½“å®ç°*ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ä¸€ä¸ªbitmapè¡¨ç¤º32ä¸ªæ•°ï¼Œå¹¶è¡¨ç¤º0-32ä¹‹é—´çš„å•æ•°ï¼š
![bit032](https://fuos.github.io/picx-images-hosting/20240825/bit032.4uav52sl01.webp)
ä»0å¼€å§‹ï¼Œæ¯ä¸ªä½ç½®çš„é¡ºåºå°±ä»£è¡¨ä¸€ä¸ªæ•°ï¼Œè¿™ä¸ªä½ç½®ä¸Šçš„å€¼ä½0è¯´æ˜ä¸å­˜åœ¨ï¼Œ1åˆ™è¯´æ˜å­˜åœ¨ã€‚å›¾ä¸Šç»¿è‰²éƒ¨åˆ†è¡¨ç¤ºğŸˆ¶ï¸ï¼Œä¸‹æ ‡æ•°å­—å°±æ˜¯å…·ä½“çš„å€¼ã€‚
æˆ‘ä»¬ç”¨4ä¸ªbyteï¼Œä¹Ÿå°±æ˜¯1ä¸ªintçš„é•¿åº¦è¡¨ç¤ºäº†16ä¸ªå•æ•°ï¼Œå¦‚æœç”¨intå­˜å‚¨ï¼Œé‚£ä¹ˆéœ€è¦4byte * 16 = 64byte = 64 * 8 = 512bitã€‚
***æ‰€ä»¥ä½¿ç”¨bitmapæ˜¯æ¯”è¾ƒèŠ‚çœå­˜å‚¨ç©ºé—´çš„ã€‚***
## QQå·å»é‡é—®é¢˜
QQå·ä½¿ç”¨`unsigned int`å­˜å‚¨ï¼Œåœ¨C++æˆ–è€…Cä¸­ï¼Œä»–çš„å­˜å‚¨èŒƒå›´æ˜¯0-2^4*8-1ï¼Œå³0åˆ°4,294,967,295ã€‚å®é™…ä¸ŠQQå·çš„èŒƒå›´æ˜¯10001åˆ°4,294,967,295ï¼Œ40äº¿å¤šä¸ªã€‚
æˆ‘ä»¬ç°åœ¨è®¡ç®—ä¸‹è¿™40äº¿QQå·ç ä½¿ç”¨intå’Œbitå­˜å‚¨ç©ºé—´å ç”¨å„æ˜¯å¤šå°‘ï¼Œå¤§è‡´çš„ä¼°ç®—ä¸‹ï¼Œå°±ä¸å»æ‰å‰é¢çš„å·ç äº†ï¼Œä¹Ÿæ²¡å¤šå°‘ä¸ªï¼š
####  ä½¿ç”¨int
æŠŠ40äº¿ä¸ªintå‹æ•°å­˜èµ·æ¥éœ€è¦çš„ç©ºé—´ï¼š40äº¿âœ–ï¸4byteâœ–ï¸8bit=1280äº¿bit  å¤§çº¦æ˜¯ 14.9GB
![image](https://fuos.github.io/picx-images-hosting/20240825/image.41xznvu825.webp)
####  ä½¿ç”¨bit
å…¶å®å°±æ˜¯è¦è¡¨ç¤º0åˆ°`2^32-1`ä¸ªæ•°ï¼Œä½¿ç”¨`2^32-1`ä¸ªbitå­˜å‚¨ï¼Œå¤§çº¦æ˜¯0.5GB
![bj1](https://fuos.github.io/picx-images-hosting/20240825/bj1.9rjbzgbu8g.webp)
å¯ä»¥çœ‹åˆ°é€šè¿‡ä½å›¾å¯ä»¥èŠ‚çœå¾ˆå¤šçš„ç©ºé—´ï¼ŒåŸºæœ¬ä¸Šå•æœºå°±èƒ½åšå»é‡ã€‚åœ¨Javaä¸­æ²¡æœ‰unsigned intï¼Œå­˜å‚¨èŒƒå›´æ˜¯`âˆ’2^31`åˆ°`2^31âˆ’1`ï¼Œæ‰€ä»¥æœ€å¤§æ•´æ•°ä½æ˜¯2,147,483,647ï¼ŒçœŸè¦å­˜40äº¿éœ€è¦ç”¨longç±»å‹ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œç¤ºèŒƒå¦‚ä½•è®¾ç½®å¯¹åº”çš„bitä½ç½®ï¼Œå¦‚ä½•å»é‡ï¼š
```Java
import java.util.BitSet;

public class QQNumberDeduplication {
    public static void main(String[] args) {
        // è®¡ç®—éœ€è¦çš„ BitSet çš„å¤§å°ã€‚2^32 - 1 æ˜¯æœ€å¤§çš„ QQ å·å‡å»æœ€å°çš„ QQ å·10001å¾—åˆ°åç§»é‡ï¼Œå†åŠ 1ã€‚
        int bitSetSize = (int) (Integer.MAX_VALUE - 10001 + 1);
        BitSet bitSet = new BitSet(bitSetSize);

        // ç¤ºä¾‹ QQ å·ç åˆ—è¡¨
        int[] qqNumbers = {10001, 10002, 2147473647, 10001, 10003};

        // å»é‡å¤„ç†
        for (int qq : qqNumbers) {
            int index = (int) (qq - 10001);
            if (!bitSet.get(index)) {
                bitSet.set(index);
                System.out.println("æ·»åŠ  QQ å·ï¼š" + qq);
            } else {
                System.out.println("QQ å· " + qq + " å·²å­˜åœ¨ï¼Œè·³è¿‡ã€‚");
            }
        }
    }
}
```
##  æ€»ç»“
æœ¬æ–‡ä»JavaåŸºæœ¬æ•°æ®ç±»å‹å‡ºå‘ï¼Œè®²è¿°äº†byteå’Œbitçš„å…³ç³»ï¼Œä»¥åŠbitmapçš„æ¦‚å¿µï¼Œä½¿ç”¨BitSetè§£å†³äº†å¤§é‡QQå·å»é‡çš„ç»å…¸é—®é¢˜ã€‚`BitSet` æ›´é€‚åˆè¡¨ç¤ºä¸€ç»„å¸ƒå°”æ ‡å¿—æˆ–éœ€è¦æŒ‰ä½æ“ä½œçš„åœºæ™¯ï¼Œè€Œä¸æ˜¯ç®€å•çš„æ•´æ•°å­˜å‚¨ã€‚åé¢å°†è¯´è¯´bitmapçš„å…¸å‹åº”ç”¨-`å¸ƒéš†è¿‡æ»¤å™¨`çš„åŸç†å’Œä½¿ç”¨åœºæ™¯ã€‚